(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const i={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"77257408-703f-4c45-a1f2-9e10cc6510eb","Content-Type":"application/json"}},d=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),J=()=>fetch(`${i.baseUrl}/users/me`,{headers:i.headers}).then(d),B=()=>fetch(`${i.baseUrl}/cards`,{headers:i.headers}).then(d),V=({name:e,about:t})=>fetch(`${i.baseUrl}/users/me`,{method:"PATCH",headers:i.headers,body:JSON.stringify({name:e,about:t})}).then(d),R=({avatar:e})=>fetch(`${i.baseUrl}/users/me/avatar`,{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:e})}).then(d),z=({name:e,link:t})=>fetch(`${i.baseUrl}/cards`,{method:"POST",headers:i.headers,body:JSON.stringify({name:e,link:t})}).then(d),K=e=>fetch(`${i.baseUrl}/cards/${e}`,{method:"DELETE",headers:i.headers}).then(d),G=(e,t)=>fetch(`${i.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:i.headers}).then(d),O=(e,t,o,n)=>{const r=e.classList.contains("card__like-button_is-active"),s=e.nextElementSibling;G(t,r).then(a=>{e.classList.toggle("card__like-button_is-active",!r),s&&(s.textContent=a.likes.length)}).catch(a=>{console.error("Ошибка при изменении статуса лайка:",a),e.classList.toggle("card__like-button_is-active",r)})},Q=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),$=(e,t,{onPreviewPicture:o,onLikeIcon:n,onDeleteCard:r})=>{const s=Q(),a=s.querySelector(".card__like-button"),_=s.querySelector(".card__control-button_type_delete"),m=s.querySelector(".card__image"),c=s.querySelector(".card__title"),l=s.querySelector(".card__like-count");return m.src=e.link,m.alt=e.name,c.textContent=e.name,l&&(l.textContent=e.likes.length),e.likes.includes(t)&&a.classList.add("card__like-button_is-active"),e.owner._id!==t?_.remove():_.addEventListener("click",()=>{r(e._id,s)}),n&&a.addEventListener("click",()=>n(a,e._id,e,t)),o&&m.addEventListener("click",()=>o({name:e.name,link:e.link})),s},X=e=>{e.remove()},F=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");p(t)}},y=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",F)},p=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",F)},Y=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{p(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&p(e)})};function Z(e,t,o,n){const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r&&(r.textContent=o,r.classList.add(n.errorClass))}function N(e,t,o){const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n&&(n.classList.remove(o.errorClass),n.textContent="")}function ee(e,t,o){let n=t.validationMessage;t.validity.patternMismatch&&t.hasAttribute("data-error-message")&&(n=t.dataset.errorMessage),t.validity.valid?N(e,t,o):Z(e,t,n,o)}function te(e){return e.some(t=>!t.validity.valid)}function E(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)}function oe(e,t){e.disabled=!1,e.classList.remove(t.inactiveButtonClass)}function ne(e,t,o){te(e)?E(t,o):oe(t,o)}function re(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);E(n,t),o.forEach(r=>{r.addEventListener("input",()=>{ee(e,r,t),ne(o,n,t)})})}function k(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{N(e,r,t)}),E(n,t)}function se(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{re(o,e)})}const H=document.querySelector(".places__list"),x=document.querySelector(".popup_type_edit"),S=x.querySelector(".popup__form"),W=S.querySelector(".popup__input_type_name"),j=S.querySelector(".popup__input_type_description");let q;const w=document.querySelector(".popup_type_new-card"),h=w.querySelector(".popup__form"),ce=h.querySelector(".popup__input_type_card-name"),ie=h.querySelector(".popup__input_type_url"),I=document.querySelector(".popup_type_image"),T=I.querySelector(".popup__image"),ae=I.querySelector(".popup__caption"),le=document.querySelector(".profile__edit-button"),ue=document.querySelector(".profile__add-button"),M=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),P=document.querySelector(".profile__image"),v=document.querySelector(".popup_type_edit-avatar"),b=v.querySelector(".popup__form"),pe=b.querySelector(".popup__input"),C=document.querySelector(".popup_type_info"),u=C.querySelector(".popup__info"),L=C.querySelector(".popup__list"),de=document.querySelector("#popup-info-definition-template");document.querySelector("#popup-info-user-preview-template");const D=({name:e,link:t})=>{T.src=t,T.alt=e,ae.textContent=e,y(I)},_e=e=>{e.preventDefault();const t=S.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",V({name:W.value,about:j.value}).then(n=>{M.textContent=n.name,A.textContent=n.about,p(x)}).catch(n=>{console.log(n)}).finally(()=>{t.textContent=o})},me=e=>{e.preventDefault();const t=b.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",R({avatar:pe.value}).then(n=>{P.style.backgroundImage=`url(${n.avatar})`,t.textContent=o,p(v)}).catch(n=>{p(v),t.textContent=o,console.log(n)})},fe=e=>{e.preventDefault();const t=h.querySelector(".popup__button"),o=t.textContent;t.textContent="Создание...",z({name:ce.value,link:ie.value}).then(n=>{H.prepend($(n,q,{onPreviewPicture:D,onLikeIcon:O,onDeleteCard:X})),p(w),h.reset()}).catch(n=>{console.log(n)}).finally(()=>{t.textContent=o})},ye=(e,t)=>{K(e).then(()=>{t.remove()}).catch(o=>{console.log(o)})},U=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),f=(e,t)=>{const o=de.content.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},he=()=>{B().then(e=>{if(u.innerHTML="",L.innerHTML="",e.length===0){u.append(f("Карточек нет","—")),y(C);return}const t=[...e].sort((c,l)=>new Date(l.createdAt)-new Date(c.createdAt)),o=t[t.length-1],n=t[0],r={};for(const c of e)c.owner&&c.owner._id&&(r[c.owner._id]=(r[c.owner._id]||0)+1);const s=Object.keys(r).length,a=Math.max(...Object.values(r));u.append(f("Всего карточек:",String(t.length))),u.append(f("Первая создана:",U(new Date(o.createdAt)))),u.append(f("Последняя создана:",U(new Date(n.createdAt)))),u.append(f("Всего пользователей:",String(s))),u.append(f("Максимум карточек от одного:",String(a)));const _=[],m=new Set;for(const c of t)c.owner&&!m.has(c.owner._id)&&(m.add(c.owner._id),_.push(c.owner));_.length>0?_.forEach(c=>{const l=document.createElement("li");l.className="popup__list-item popup__list-item_type_badge",l.textContent=c.name||"Без имени",L.append(l)}):L.innerHTML="<li class='popup__list-item'>Нет данных</li>",y(C)}).catch(e=>{console.error("Ошибка при загрузке карточек:",e)})};S.addEventListener("submit",_e);h.addEventListener("submit",fe);b.addEventListener("submit",me);le.addEventListener("click",()=>{W.value=M.textContent,j.value=A.textContent,k(S,g),y(x)});P.addEventListener("click",()=>{k(b,g),y(v)});ue.addEventListener("click",()=>{k(h,g),y(w)});const Se=document.querySelectorAll(".popup");Se.forEach(e=>{Y(e)});const g={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};se(g);Promise.all([B(),J()]).then(([e,t])=>{q=t._id,M.textContent=t.name||"Имя не указано",A.textContent=t.about||"Описание отсутствует",t.avatar&&(P.style.backgroundImage=`url(${t.avatar})`),e.forEach(o=>{H.append($(o,q,{onPreviewPicture:D,onLikeIcon:O,onDeleteCard:ye}))})}).catch(e=>{console.error("Ошибка загрузки данных:",e)});const ve=document.querySelector(".logo");ve.addEventListener("click",he);
